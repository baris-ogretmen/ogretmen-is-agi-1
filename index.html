<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Ã–ÄŸretmen Ä°ÅŸ AÄŸÄ± | TÃ¼rkiye Geneli</title>
    <meta name="description" content="TÃ¼rkiye geneli Ã¶ÄŸretmen ve eÄŸitim personeli iÅŸ ilanlarÄ± platformu.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.5s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite'
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .glass-header { background: rgba(255, 255, 255, 0.98); border-bottom: 1px solid #e2e8f0; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .loader-overlay { position: fixed; inset: 0; background: white; z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        
        .tab-content { display: none; animation: fadeIn 0.3s ease-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .job-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid #f1f5f9; overflow: hidden; }
        .job-card:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        
        /* Delete Button Hover */
        .card-action-btn { opacity: 0; transition: opacity 0.2s; }
        .job-card:hover .card-action-btn { opacity: 1; }

        /* Pop-up Animation */
        .pop-in { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        
        /* Marquee Container Fix */
        .marquee-container { overflow: hidden; white-space: nowrap; position: relative; width: 100%; }
        .marquee-content { display: inline-block; padding-left: 100%; animation: marquee 45s linear infinite; }
        
        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        
        .favorite-active { color: #ef4444 !important; }
    </style>
</head>
<body class="text-slate-800 flex flex-col min-h-screen">

    <div id="app-loader" class="loader-overlay">
        <div class="w-16 h-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mb-4"></div>
        <h2 class="text-xl font-bold text-slate-800">Platform YÃ¼kleniyor...</h2>
        <p class="text-sm text-slate-500 mt-2">En gÃ¼ncel ilanlar getiriliyor.</p>
    </div>

    <header class="glass-header sticky top-0 z-30 shadow-sm">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3" onclick="location.reload()" style="cursor: pointer;">
                <div class="bg-gradient-to-br from-blue-600 to-indigo-600 text-white p-2.5 rounded-xl shadow-lg shadow-indigo-200">
                    <i class="fa-solid fa-users-viewfinder text-xl"></i>
                </div>
                <div>
                    <h1 class="font-bold text-lg leading-tight text-slate-800">Ã–ÄŸretmen Ä°ÅŸ AÄŸÄ±</h1>
                    <p class="text-[10px] font-bold text-indigo-600 tracking-wider uppercase">TÃ¼rkiye Geneli Ä°lan Platformu</p>
                </div>
            </div>
            
            <div class="flex items-center gap-3">
                <button onclick="toggleAdminPanel()" class="w-9 h-9 rounded-full bg-slate-100 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 transition flex items-center justify-center" title="YÃ¶netici Paneli">
                    <i class="fa-solid fa-gear"></i>
                </button>
                <button onclick="switchTab('favorites')" class="w-9 h-9 rounded-full bg-red-50 text-red-400 hover:text-red-600 hover:bg-red-100 transition flex items-center justify-center relative" title="Favorilerim">
                    <i class="fa-solid fa-heart"></i>
                    <span id="fav-count-badge" class="absolute -top-1 -right-1 w-4 h-4 bg-red-600 text-white text-[9px] flex items-center justify-center rounded-full hidden">0</span>
                </button>
                <a href="#ilan-ver" onclick="switchTab('post')" class="hidden md:flex bg-slate-800 text-white px-5 py-2.5 rounded-full text-xs font-bold items-center gap-2 hover:bg-slate-700 transition shadow-lg shadow-slate-200">
                    <i class="fa-solid fa-plus"></i> Ãœcretsiz Ä°lan Ver
                </a>
            </div>
        </div>
    </header>

    <!-- DÄ°NAMÄ°K HABER BANDI (MARQUEE) -->
    <div class="bg-indigo-900 text-white text-xs font-medium py-2 overflow-hidden relative z-20 shadow-inner border-b border-indigo-800">
        <div class="marquee-container">
            <div id="marquee-text" class="marquee-content flex gap-8 items-center">
                <span><i class="fa-solid fa-circle-notch fa-spin text-indigo-400 mr-2"></i>Sistem verileri yÃ¼kleniyor...</span>
            </div>
        </div>
    </div>

    <main class="flex-grow container mx-auto px-4 py-6 max-w-6xl">

        <!-- TAB BUTTONS MOBILE -->
        <div class="flex p-1.5 bg-white rounded-2xl shadow-sm border border-slate-200 mb-6 md:hidden">
            <button onclick="switchTab('jobs')" id="tab-btn-jobs" class="flex-1 py-3 text-sm font-bold rounded-xl transition-all text-white bg-indigo-600 shadow-sm flex items-center justify-center gap-2">
                <i class="fa-solid fa-list-ul"></i> Ä°lanlar
            </button>
            <button onclick="switchTab('post')" id="tab-btn-post" class="flex-1 py-3 text-sm font-bold rounded-xl transition-all text-slate-500 hover:bg-slate-50 flex items-center justify-center gap-2">
                <i class="fa-solid fa-plus-circle"></i> Ä°lan Ver
            </button>
        </div>

        <!-- Ä°LAN LÄ°STESÄ° -->
        <div id="tab-jobs" class="tab-content active">
            
            <!-- FÄ°LTRELER -->
            <div class="bg-white p-5 rounded-3xl border border-slate-100 shadow-xl shadow-slate-200/50 mb-8 animate-fade-in-up">
                
                <!-- Ä°LAN TÄ°PÄ° SEÃ‡Ä°CÄ° -->
                <div class="flex p-1 bg-slate-100 rounded-xl mb-5 max-w-lg mx-auto">
                    <button onclick="setFilterType('all')" id="ft-all" class="flex-1 py-2 rounded-lg text-xs font-bold transition-all bg-white text-slate-800 shadow-sm">TÃ¼mÃ¼</button>
                    <button onclick="setFilterType('institution')" id="ft-institution" class="flex-1 py-2 rounded-lg text-xs font-bold transition-all text-slate-500 hover:text-green-600">Ä°ÅŸ Ä°lanlarÄ±</button>
                    <button onclick="setFilterType('teacher')" id="ft-teacher" class="flex-1 py-2 rounded-lg text-xs font-bold transition-all text-slate-500 hover:text-blue-600">Ã–ÄŸretmenler</button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="relative">
                        <i class="fa-solid fa-search absolute left-4 top-3.5 text-slate-400 text-sm"></i>
                        <input type="text" id="search-text" onkeyup="applyFilters()" placeholder="Kelime ara..." class="w-full pl-10 bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-xl p-3 outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition">
                    </div>
                    
                    <select id="filter-city" onchange="updateDistricts('filter'); applyFilters()" class="bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-xl p-3 outline-none focus:border-indigo-500 cursor-pointer">
                        <option value="all">TÃ¼m Ä°ller</option>
                    </select>

                    <select id="filter-role" onchange="applyFilters()" class="bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-xl p-3 outline-none focus:border-indigo-500 cursor-pointer">
                        <option value="all">TÃ¼m BranÅŸlar</option>
                    </select>

                    <div class="flex items-center justify-between text-xs font-bold text-slate-500 bg-slate-50 rounded-xl px-4 border border-slate-200">
                        <span>SonuÃ§:</span>
                        <span id="active-job-count" class="text-indigo-600 text-lg">0</span>
                    </div>
                </div>
            </div>

            <!-- Ä°LAN KARTLARI CONTAINER -->
            <div id="jobs-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 pb-10">
                <!-- Javascript ile doldurulacak -->
            </div>
            
             <div id="no-jobs-msg" class="hidden text-center py-12">
                <div class="w-24 h-24 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-300 text-4xl"><i class="fa-solid fa-wind"></i></div>
                <h3 class="font-bold text-slate-700 text-lg">HiÃ§ ilan bulunamadÄ±.</h3>
                <p class="text-sm text-slate-500 mt-2">Arama kriterlerinizi deÄŸiÅŸtirerek tekrar deneyin.</p>
                <button onclick="resetFilters()" class="mt-6 bg-slate-800 text-white px-6 py-2 rounded-full text-sm font-bold hover:bg-slate-700 transition">Filtreleri Temizle</button>
            </div>
        </div>

        <!-- FAVORÄ°LER TABI -->
        <div id="tab-favorites" class="tab-content">
            <div class="flex items-center gap-3 mb-6">
                <button onclick="switchTab('jobs')" class="w-10 h-10 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-600"><i class="fa-solid fa-arrow-left"></i></button>
                <h2 class="text-2xl font-black text-slate-800">Favori Ä°lanlarÄ±m</h2>
            </div>
            <div id="fav-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 pb-10">
                 <!-- JS ile dolar -->
            </div>
            <div id="no-fav-msg" class="hidden text-center py-12">
                <div class="w-24 h-24 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 text-red-200 text-4xl"><i class="fa-solid fa-heart-crack"></i></div>
                <h3 class="font-bold text-slate-700 text-lg">Favori ilanÄ±nÄ±z yok.</h3>
                <p class="text-sm text-slate-500 mt-2">Ä°lanlardaki kalp ikonuna tÄ±klayarak buraya ekleyebilirsiniz.</p>
            </div>
        </div>

        <!-- Ä°LAN VERME FORMU -->
        <div id="tab-post" class="tab-content max-w-2xl mx-auto pb-10">
            <div class="bg-white rounded-3xl p-6 md:p-8 shadow-2xl border border-slate-100 relative overflow-hidden animate-fade-in-up">
                
                <div class="text-center mb-8 relative z-10">
                    <h2 class="text-2xl font-black text-slate-800 tracking-tight">Ãœcretsiz Ä°lan OluÅŸtur</h2>
                    <p class="text-sm text-slate-500 mt-2 font-medium">Ä°lanÄ±nÄ±zÄ± daha sonra kaldÄ±rabilmek iÃ§in pin belirlemeyi unutmayÄ±n.</p>
                </div>

                <!-- TÃœR SEÃ‡Ä°MÄ° -->
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <label class="cursor-pointer relative">
                        <input type="radio" name="postType" value="institution" class="peer sr-only" checked onchange="updateFormLabels()">
                        <div class="p-4 rounded-2xl border-2 border-slate-100 bg-slate-50 text-center transition-all peer-checked:border-green-500 peer-checked:bg-green-50 peer-checked:text-green-700 hover:bg-white hover:shadow-md">
                            <div class="text-3xl mb-2 text-green-500"><i class="fa-solid fa-building-user"></i></div>
                            <div class="font-bold text-sm">KURUM</div>
                            <div class="text-[10px] opacity-75">Personel ArÄ±yorum</div>
                        </div>
                        <div class="absolute top-3 right-3 text-green-600 opacity-0 peer-checked:opacity-100 transition-opacity"><i class="fa-solid fa-circle-check"></i></div>
                    </label>

                    <label class="cursor-pointer relative">
                        <input type="radio" name="postType" value="teacher" class="peer sr-only" onchange="updateFormLabels()">
                        <div class="p-4 rounded-2xl border-2 border-slate-100 bg-slate-50 text-center transition-all peer-checked:border-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 hover:bg-white hover:shadow-md">
                            <div class="text-3xl mb-2 text-blue-500"><i class="fa-solid fa-user-graduate"></i></div>
                            <div class="font-bold text-sm">Ã–ÄžRETMEN</div>
                            <div class="text-[10px] opacity-75">Ä°ÅŸ ArÄ±yorum</div>
                        </div>
                        <div class="absolute top-3 right-3 text-blue-600 opacity-0 peer-checked:opacity-100 transition-opacity"><i class="fa-solid fa-circle-check"></i></div>
                    </label>
                </div>

                <form id="jobForm" class="space-y-5 relative z-10">
                    
                    <div>
                        <label id="lbl-title" class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Ä°lan BaÅŸlÄ±ÄŸÄ±</label>
                        <input type="text" id="post-title" placeholder="Ã–rn: SÄ±nÄ±f Ã–ÄŸretmeni ArÄ±yoruz" class="w-full bg-slate-50 border border-slate-200 text-slate-800 text-sm rounded-xl focus:ring-indigo-500 focus:border-indigo-500 block p-3.5 outline-none transition font-semibold" required>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div>
                            <label id="lbl-name" class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Kurum AdÄ±</label>
                            <input type="text" id="post-company" placeholder="Kurumunuzun adÄ±" class="w-full bg-slate-50 border border-slate-200 text-slate-800 text-sm rounded-xl focus:ring-indigo-500 focus:border-indigo-500 block p-3.5 outline-none transition" required>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">BranÅŸ</label>
                            <select id="post-role" class="w-full bg-slate-50 border border-slate-200 text-slate-800 text-sm rounded-xl focus:ring-indigo-500 focus:border-indigo-500 block p-3.5 outline-none transition" required>
                                <option value="" disabled selected>BranÅŸ SeÃ§iniz...</option>
                                <!-- JS ile doldurulacak -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- YENÄ°: Ã‡ALIÅžMA ÅžEKLÄ° -->
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Ã‡alÄ±ÅŸma Åžekli</label>
                        <select id="post-work-type" class="w-full bg-slate-50 border border-slate-200 text-slate-800 text-sm rounded-xl focus:ring-indigo-500 focus:border-indigo-500 block p-3.5 outline-none transition" required>
                             <option value="Tam ZamanlÄ±">Tam ZamanlÄ±</option>
                             <option value="YarÄ± ZamanlÄ±">YarÄ± ZamanlÄ±</option>
                             <option value="Ã–zel Ders">Ã–zel Ders</option>
                             <option value="Proje BazlÄ±">Proje BazlÄ±</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-5">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Ä°l</label>
                            <select id="entry-city" onchange="updateDistricts('entry')" class="w-full bg-slate-50 border border-slate-200 text-slate-800 text-sm rounded-xl focus:ring-indigo-500 focus:border-indigo-500 block p-3.5 outline-none transition" required>
                                <option value="" disabled selected>Ä°l SeÃ§...</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Ä°lÃ§e</label>
                            <select id="entry-district" class="w-full bg-slate-50 border border-slate-200 text-slate-800 text-sm rounded-xl focus:ring-indigo-500 focus:border-indigo-500 block p-3.5 outline-none transition" disabled required>
                                <option value="" disabled selected>Ã–nce Ä°l</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label id="lbl-desc" class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Detaylar</label>
                        <textarea id="post-desc" rows="4" placeholder="Aranan Ã¶zellikler, Ã§alÄ±ÅŸma ÅŸartlarÄ± vb." class="w-full bg-slate-50 border border-slate-200 text-slate-800 text-sm rounded-xl focus:ring-indigo-500 focus:border-indigo-500 block p-3.5 outline-none transition" required></textarea>
                    </div>

                    <div class="p-4 bg-slate-50 rounded-xl border border-slate-200">
                        <h4 class="text-xs font-bold text-slate-700 mb-3 flex items-center gap-2"><i class="fa-solid fa-address-book text-indigo-500"></i> Ä°letiÅŸim Tercihleri</h4>
                        
                        <!-- Ä°LETÄ°ÅžÄ°M YÃ–NTEMÄ° SEÃ‡Ä°MÄ° (YENÄ°) -->
                        <div class="flex gap-4 mb-4">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="contactMethod" value="phone" checked onchange="toggleContactFields()" class="accent-indigo-600 w-4 h-4">
                                <span class="text-xs font-bold text-slate-600">Telefon & WhatsApp</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="contactMethod" value="email" onchange="toggleContactFields()" class="accent-indigo-600 w-4 h-4">
                                <span class="text-xs font-bold text-slate-600">Sadece E-posta (Gizlilik)</span>
                            </label>
                        </div>

                        <div class="grid grid-cols-1 gap-4">
                            <div id="field-phone">
                                <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Telefon / WhatsApp</label>
                                <input type="tel" id="post-phone" placeholder="0555 123 45 67" class="w-full bg-white border border-slate-200 text-slate-800 text-sm rounded-lg p-3 outline-none focus:border-indigo-500">
                            </div>
                            
                            <div id="field-email" class="hidden">
                                <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">E-posta Adresi</label>
                                <input type="email" id="post-email" placeholder="ornek@gmail.com" class="w-full bg-white border border-slate-200 text-slate-800 text-sm rounded-lg p-3 outline-none focus:border-indigo-500">
                                <p class="text-[9px] text-slate-400 mt-1"><i class="fa-solid fa-lock"></i> Telefon numaranÄ±z bu ilanda yayÄ±nlanmayacak.</p>
                            </div>

                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Ä°lgili KiÅŸi</label>
                                <input type="text" id="post-contact-person" placeholder="Ad Soyad" class="w-full bg-white border border-slate-200 text-slate-800 text-sm rounded-lg p-3 outline-none focus:border-indigo-500" required>
                            </div>
                        </div>
                    </div>

                    <!-- GÃœVENLÄ°K PÄ°NÄ° -->
                    <div class="p-4 bg-red-50 rounded-xl border border-red-100">
                        <h4 class="text-xs font-bold text-red-700 mb-2 flex items-center gap-2">
                            <i class="fa-solid fa-key"></i> Ä°lan GÃ¼venlik Pini
                        </h4>
                        <p class="text-[10px] text-red-500 mb-3">Bu pini unutmayÄ±n! Ä°lanÄ±nÄ±zÄ± kaldÄ±rmak istediÄŸinizde bu ÅŸifreyi kullanacaksÄ±nÄ±z.</p>
                        <input type="text" id="post-pin" maxlength="4" placeholder="Ã–rn: 1923" pattern="\d{4}" title="4 haneli rakam giriniz" class="w-full bg-white border border-red-200 text-red-800 text-center text-lg font-bold rounded-lg p-3 outline-none focus:border-red-500 tracking-widest" required>
                    </div>

                    <div class="flex items-start gap-2 bg-yellow-50 p-3 rounded-lg border border-yellow-100">
                        <input type="checkbox" id="terms" class="mt-1 accent-indigo-600" required>
                        <label for="terms" class="text-xs text-slate-600">VerdiÄŸim bilgilerin doÄŸruluÄŸunu kabul ediyorum. Uygunsuz veya yanÄ±ltÄ±cÄ± ilanlarÄ±n silineceÄŸini biliyorum.</label>
                    </div>

                    <button type="submit" id="submit-btn" class="w-full text-white bg-slate-800 hover:bg-slate-900 focus:ring-4 focus:ring-slate-300 font-bold rounded-xl text-base px-5 py-4 text-center transition-all shadow-lg shadow-slate-300 flex items-center justify-center gap-2 mt-2">
                        <span>Ä°lanÄ± YayÄ±nla</span>
                        <i class="fa-solid fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>

    </main>

    <!-- DÄ°NAMÄ°K DUYURU MODAL (ADMÄ°N) -->
    <div id="user-announcement-modal" class="fixed inset-0 z-[100] bg-black/70 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] p-8 w-full max-w-sm text-center shadow-2xl pop-in relative border-4 border-indigo-600">
            <button onclick="document.getElementById('user-announcement-modal').classList.add('hidden')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i class="fa-solid fa-xmark"></i></button>
            <div class="w-20 h-20 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center text-4xl mx-auto mb-6 animate-bounce"><i class="fa-solid fa-bell"></i></div>
            <h3 class="text-xl font-black text-slate-800 mb-3">DUYURU</h3>
            <p id="user-popup-content" class="text-slate-600 mb-8 font-medium text-sm leading-relaxed whitespace-pre-line">...</p>
            <button onclick="document.getElementById('user-announcement-modal').classList.add('hidden')" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-indigo-200">Tamam, Okudum</button>
        </div>
    </div>

    <!-- WELCOME POPUP (BARIÅž Ã–ÄžRETMEN & BÄ°LGÄ°) -->
    <div id="welcome-modal" class="fixed inset-0 bg-slate-900/80 z-[90] hidden flex items-center justify-center p-4 backdrop-blur-sm transition-opacity">
        <div class="bg-white rounded-3xl p-6 w-full max-w-md shadow-2xl relative pop-in">
            <button onclick="closeWelcomeModal()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 transition"><i class="fa-solid fa-xmark text-xl"></i></button>
            
            <div class="text-center mb-4 mt-2">
                <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-3 text-2xl shadow-lg shadow-indigo-200 animate-bounce">
                    <i class="fa-solid fa-handshake"></i>
                </div>
                <h2 class="text-xl font-black text-slate-800 mb-1">HoÅŸ Geldiniz!</h2>
                <p class="text-xs text-slate-500 px-4">TÃ¼rkiye'nin en kapsamlÄ± <strong>Ã–ÄŸretmen Ä°ÅŸ AÄŸÄ±</strong>.</p>
            </div>

            <!-- BARIÅž Ã–ÄžRETMEN REKLAM ALANI -->
            <div class="bg-gradient-to-r from-violet-50 to-purple-50 p-4 rounded-xl border border-violet-100 mb-5 text-center shadow-sm relative overflow-hidden group">
                <div class="absolute -right-4 -top-4 w-12 h-12 bg-violet-200 rounded-full opacity-20 group-hover:scale-150 transition"></div>
                
                <p class="text-xs text-violet-800 font-bold mb-1 flex items-center justify-center gap-1">
                    <i class="fa-solid fa-book-open text-violet-500"></i> Ders Materyali Ä°htiyacÄ±nÄ±z mÄ± Var?
                </p>
                <p class="text-[10px] text-slate-600 mb-3 leading-snug px-2">
                    DeÄŸerli arkadaÅŸlar, gÃ¼ncel dijital eÄŸitim iÃ§erikleri ve sÄ±nÄ±f iÃ§i etkinlikler iÃ§in sitemi inceleyebilirsiniz.
                </p>
                
                <a href="https://baris-ogretmen.github.io/site-1/" target="_blank" class="inline-flex items-center gap-2 bg-violet-600 text-white text-[10px] font-bold px-4 py-2 rounded-lg hover:bg-violet-700 transition shadow-md shadow-violet-200">
                    <i class="fa-solid fa-link"></i> Siteye Git
                </a>
            </div>

            <!-- KURUM VS Ã–ÄžRETMEN KUTULARI -->
            <div class="space-y-3 mb-5">
                <div class="flex items-start gap-3 p-3 bg-green-50 rounded-xl border border-green-100">
                    <div class="text-green-600 mt-0.5"><i class="fa-solid fa-building-circle-check"></i></div>
                    <div>
                        <h4 class="text-xs font-bold text-green-800">Kurumlar</h4>
                        <p class="text-[11px] text-green-600 leading-tight">AradÄ±ÄŸÄ±nÄ±z eÄŸitimciyi bulmak iÃ§in Ã¼cretsiz ilan verin.</p>
                    </div>
                </div>
                <div class="flex items-start gap-3 p-3 bg-blue-50 rounded-xl border border-blue-100">
                    <div class="text-blue-600 mt-0.5"><i class="fa-solid fa-user-graduate"></i></div>
                    <div>
                        <h4 class="text-xs font-bold text-blue-800">Ã–ÄŸretmenler</h4>
                        <p class="text-[11px] text-blue-600 leading-tight">Kendinizi tanÄ±tan ilanlar oluÅŸturarak kurumlarÄ±n size ulaÅŸmasÄ±nÄ± saÄŸlayÄ±n.</p>
                    </div>
                </div>
            </div>

            <button onclick="closeWelcomeModal()" class="w-full bg-slate-800 text-white font-bold py-3.5 rounded-xl text-sm hover:bg-slate-700 transition shadow-lg shadow-slate-200">
                Hemen BaÅŸla ðŸš€
            </button>
        </div>
    </div>

    <!-- DELETE MODAL -->
    <div id="delete-modal" class="fixed inset-0 bg-slate-900/90 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm text-center shadow-2xl pop-in">
            <div class="w-16 h-16 bg-red-100 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">
                <i class="fa-solid fa-trash-can"></i>
            </div>
            <h3 class="text-lg font-bold text-slate-800 mb-2">Ä°lanÄ± KaldÄ±r</h3>
            <p class="text-sm text-slate-500 mb-4">AradÄ±ÄŸÄ±nÄ±zÄ± buldunuz mu? Ä°lanÄ± kaldÄ±rmak iÃ§in oluÅŸtururken belirlediÄŸiniz 4 haneli pini giriniz.</p>
            
            <input type="text" id="delete-pin-input" maxlength="4" placeholder="****" class="w-32 mx-auto bg-slate-50 border-2 border-slate-200 text-slate-800 text-center text-xl font-bold rounded-xl p-3 outline-none focus:border-red-500 mb-4 tracking-widest">
            
            <div class="flex gap-3">
                <button onclick="closeDeleteModal()" class="flex-1 bg-slate-100 text-slate-600 py-3 rounded-xl font-bold text-sm hover:bg-slate-200">Ä°ptal</button>
                <button onclick="confirmDelete()" class="flex-1 bg-red-600 text-white py-3 rounded-xl font-bold text-sm hover:bg-red-700 shadow-lg shadow-red-200">KaldÄ±r</button>
            </div>
        </div>
    </div>

    <!-- ADMIN MODAL -->
    <div id="admin-modal" class="fixed inset-0 bg-slate-900/90 z-50 hidden flex items-center justify-center p-4 backdrop-blur-md">
        <div class="bg-white rounded-[2rem] p-6 w-full max-w-5xl shadow-2xl h-[85vh] flex flex-col relative overflow-hidden">
            <button onclick="toggleAdminPanel()" class="absolute top-5 right-5 text-slate-400 hover:text-slate-600 z-10"><i class="fa-solid fa-circle-xmark text-2xl"></i></button>
            
            <div id="admin-login-view" class="h-full flex flex-col items-center justify-center">
                <div class="w-16 h-16 bg-slate-100 text-slate-600 rounded-full flex items-center justify-center text-3xl mb-4 shadow-lg"><i class="fa-solid fa-lock"></i></div>
                <h3 class="text-xl font-bold mb-4 text-slate-800">YÃ¶netici Paneli</h3>
                <input type="email" id="admin-email" placeholder="E-posta" class="border-2 border-slate-200 p-3 rounded-xl mb-2 w-64 outline-none focus:border-indigo-500 font-bold text-center">
                <input type="password" id="admin-pass" placeholder="Åžifre" class="border-2 border-slate-200 p-3 rounded-xl mb-4 w-64 outline-none focus:border-indigo-500 font-bold text-center">
                <button onclick="adminLogin()" class="bg-slate-800 text-white px-12 py-3 rounded-xl font-bold hover:bg-slate-700 transition shadow-lg">GiriÅŸ Yap</button>
                <div id="admin-msg" class="text-red-500 text-sm mt-3 font-bold hidden"></div>
            </div>
            
            <div id="admin-controls-view" class="hidden h-full flex flex-col">
                <div class="flex items-center gap-3 mb-6 border-b pb-4">
                    <div class="w-10 h-10 bg-slate-800 text-white rounded-xl flex items-center justify-center text-lg"><i class="fa-solid fa-shield-halved"></i></div>
                    <div><h3 class="font-bold text-lg text-slate-800">YÃ¶netim Merkezi</h3><p class="text-xs text-slate-500">Ä°lanlar ve sistem ayarlarÄ±.</p></div>
                    <button onclick="logoutAdmin()" class="ml-auto bg-slate-100 text-slate-600 px-4 py-2 rounded-lg text-xs font-bold hover:bg-slate-200">Ã‡Ä±kÄ±ÅŸ</button>
                </div>
                
                <div class="admin-grid">
                     <!-- SOL: KONFÄ°GÃœRASYON (YENÄ°) -->
                     <div class="overflow-y-auto pr-2 space-y-4 custom-scroll">
                        <!-- Pop-up AyarÄ± -->
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                            <h4 class="font-bold text-indigo-700 text-sm mb-2 flex items-center gap-2"><i class="fa-solid fa-comment-dots"></i> Pop-up Duyuru</h4>
                            <textarea id="admin-input-popup" class="w-full p-3 rounded-lg border border-slate-300 text-xs mb-2 outline-none" rows="3" placeholder="Duyuru metni... Link yazarsan otomatik tÄ±klanabilir olur."></textarea>
                            <button onclick="saveConfig('popup')" class="w-full bg-indigo-600 text-white py-2 rounded-lg text-xs font-bold hover:bg-indigo-700">Duyuruyu YayÄ±nla</button>
                        </div>

                        <!-- Haber BandÄ± AyarÄ± -->
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                            <h4 class="font-bold text-orange-600 text-sm mb-2 flex items-center gap-2"><i class="fa-solid fa-scroll"></i> Haber BandÄ± (Marquee)</h4>
                            <textarea id="admin-input-news" class="w-full p-3 rounded-lg border border-slate-300 text-xs mb-2 outline-none" rows="2" placeholder="Ãœstte kayan yazÄ±... HTML kullanabilirsin."></textarea>
                            <button onclick="saveConfig('news')" class="w-full bg-orange-500 text-white py-2 rounded-lg text-xs font-bold hover:bg-orange-600">BandÄ± GÃ¼ncelle</button>
                        </div>
                     </div>

                    <!-- SAÄž: Ä°LAN LÄ°STESÄ° -->
                    <div class="flex flex-col bg-white border border-slate-200 rounded-xl overflow-hidden shadow-inner h-full">
                        <div class="p-3 bg-slate-100 border-b flex justify-between items-center text-xs font-bold text-slate-600">
                            <span>TÃ¼m Ä°lanlar</span>
                            <span id="admin-record-count" class="bg-white px-2 py-0.5 rounded shadow-sm text-slate-800">0</span>
                        </div>
                        <div id="admin-records-list" class="flex-1 overflow-y-auto p-2 space-y-2 custom-scroll bg-slate-50"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, serverTimestamp, setDoc, query, orderBy, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ÅžEHÄ°R VERÄ°TABANI
        const TURKEY_DATA = {
            "Adana": ["AladaÄŸ","Ceyhan","Ã‡ukurova","Feke","Ä°mamoÄŸlu","KaraisalÄ±","KarataÅŸ","Kozan","PozantÄ±","Saimbeyli","SarÄ±Ã§am","Seyhan","Tufanbeyli","YumurtalÄ±k","YÃ¼reÄŸir"],
            "AdÄ±yaman": ["Besni","Ã‡elikhan","Gerger","GÃ¶lbaÅŸÄ±","Kahta","Merkez","Samsat","Sincik","Tut"],
            "Afyonkarahisar": ["BaÅŸmakÃ§Ä±","Bayat","Bolvadin","Ã‡ay","Ã‡obanlar","DazkÄ±rÄ±","Dinar","EmirdaÄŸ","Evciler","Hocalar","Ä°hsaniye","Ä°scehisar","KÄ±zÄ±lÃ¶ren","Merkez","SandÄ±klÄ±","SinanpaÅŸa","SultandaÄŸÄ±","Åžuhut"],
            "AÄŸrÄ±": ["Diyadin","DoÄŸubayazÄ±t","EleÅŸkirt","Hamur","Merkez","Patnos","TaÅŸlÄ±Ã§ay","Tutak"],
            "Aksaray": ["AÄŸaÃ§Ã¶ren","Eskil","GÃ¼laÄŸaÃ§","GÃ¼zelyurt","Merkez","OrtakÃ¶y","SarÄ±yahÅŸi","SultanhanÄ±"],
            "Amasya": ["GÃ¶ynÃ¼cek","GÃ¼mÃ¼ÅŸhacÄ±kÃ¶y","HamamÃ¶zÃ¼","Merkez","Merzifon","Suluova","TaÅŸova"],
            "Ankara": ["Akyurt","AltÄ±ndaÄŸ","AyaÅŸ","Bala","BeypazarÄ±","Ã‡amlÄ±dere","Ã‡ankaya","Ã‡ubuk","ElmadaÄŸ","Etimesgut","Evren","GÃ¶lbaÅŸÄ±","GÃ¼dÃ¼l","Haymana","Kalecik","Kahramankazan","KeÃ§iÃ¶ren","KÄ±zÄ±lcahamam","Mamak","NallÄ±han","PolatlÄ±","Pursaklar","Sincan","ÅžereflikoÃ§hisar","Yenimahalle"],
            "Antalya": ["Akseki","Aksu","Alanya","Demre","DÃ¶ÅŸemealtÄ±","ElmalÄ±","Finike","GazipaÅŸa","GÃ¼ndoÄŸmuÅŸ","Ä°bradÄ±","KaÅŸ","Kemer","Kepez","KonyaaltÄ±","Korkuteli","Kumluca","Manavgat","MuratpaÅŸa","Serik"],
            "Ardahan": ["Ã‡Ä±ldÄ±r","Damal","GÃ¶le","Hanak","Merkez","Posof"],
            "Artvin": ["ArdanuÃ§","Arhavi","BorÃ§ka","Hopa","KemalpaÅŸa","Merkez","Murgul","ÅžavÅŸat","Yusufeli"],
            "AydÄ±n": ["BozdoÄŸan","Buharkent","Ã‡ine","Didim","Efeler","Germencik","Ä°ncirliova","Karacasu","Karpuzlu","KoÃ§arlÄ±","KÃ¶ÅŸk","KuÅŸadasÄ±","Kuyucak","Nazilli","SÃ¶ke","Sultanhisar","Yenipazar"],
            "BalÄ±kesir": ["AltÄ±eylÃ¼l","AyvalÄ±k","Balya","BandÄ±rma","BigadiÃ§","Burhaniye","Dursunbey","Edremit","Erdek","GÃ¶meÃ§","GÃ¶nen","Havran","Ä°vrindi","Karesi","Kepsut","Manyas","Marmara","SavaÅŸtepe","SÄ±ndÄ±rgÄ±","Susurluk"],
            "BartÄ±n": ["Amasra","KurucaÅŸile","Merkez","Ulus"],
            "Batman": ["BeÅŸiri","GercÃ¼ÅŸ","Hasankeyf","Kozluk","Merkez","Sason"],
            "Bayburt": ["AydÄ±ntepe","DemirÃ¶zÃ¼","Merkez"],
            "Bilecik": ["BozÃ¼yÃ¼k","GÃ¶lpazarÄ±","Ä°nhisar","Merkez","Osmaneli","Pazaryeri","SÃ¶ÄŸÃ¼t","Yenipazar"],
            "BingÃ¶l": ["AdaklÄ±","GenÃ§","KarlÄ±ova","KiÄŸÄ±","Merkez","Solhan","Yayladere","Yedisu"],
            "Bitlis": ["Adilcevaz","Ahlat","GÃ¼roymak","Hizan","Merkez","Mutki","Tatvan"],
            "Bolu": ["DÃ¶rtdivan","Gerede","GÃ¶ynÃ¼k","KÄ±brÄ±scÄ±k","Mengen","Merkez","Mudurnu","Seben","YeniÃ§aÄŸa"],
            "Burdur": ["AÄŸlasun","AltÄ±nyayla","Bucak","Ã‡avdÄ±r","Ã‡eltikÃ§i","GÃ¶lhisar","KaramanlÄ±","Kemer","Merkez","Tefenni","YeÅŸilova"],
            "Bursa": ["BÃ¼yÃ¼korhan","Gemlik","GÃ¼rsu","HarmancÄ±k","Ä°negÃ¶l","Ä°znik","Karacabey","Keles","Kestel","Mudanya","MustafakemalpaÅŸa","NilÃ¼fer","Orhaneli","Orhangazi","Osmangazi","YeniÅŸehir","YÄ±ldÄ±rÄ±m"],
            "Ã‡anakkale": ["AyvacÄ±k","BayramiÃ§","Biga","Bozcaada","Ã‡an","Eceabat","Ezine","Gelibolu","GÃ¶kÃ§eada","Lapseki","Merkez","Yenice"],
            "Ã‡ankÄ±rÄ±": ["Atkaracalar","BayramÃ¶ren","Ã‡erkeÅŸ","Eldivan","Ilgaz","KÄ±zÄ±lÄ±rmak","Korgun","KurÅŸunlu","Merkez","Orta","ÅžabanÃ¶zÃ¼","YapraklÄ±"],
            "Ã‡orum": ["Alaca","Bayat","BoÄŸazkale","Dodurga","Ä°skilip","KargÄ±","LaÃ§in","MecitÃ¶zÃ¼","Merkez","OÄŸuzlar","OrtakÃ¶y","OsmancÄ±k","Sungurlu","UÄŸurludaÄŸ"],
            "Denizli": ["AcÄ±payam","BabadaÄŸ","Baklan","Bekilli","BeyaÄŸaÃ§","Bozkurt","Buldan","Ã‡al","Ã‡ameli","Ã‡ardak","Ã‡ivril","GÃ¼ney","Honaz","Kale","Merkezefendi","Pamukkale","SaraykÃ¶y","Serinhisar","Tavas"],
            "DiyarbakÄ±r": ["BaÄŸlar","Bismil","Ã‡ermik","Ã‡Ä±nar","Ã‡Ã¼ngÃ¼ÅŸ","Dicle","EÄŸil","Ergani","Hani","Hazro","KayapÄ±nar","KocakÃ¶y","Kulp","Lice","Silvan","Sur","YeniÅŸehir"],
            "DÃ¼zce": ["AkÃ§akoca","Cumayeri","Ã‡ilimli","GÃ¶lyaka","GÃ¼mÃ¼ÅŸova","KaynaÅŸlÄ±","Merkez","YÄ±ÄŸÄ±lca"],
            "Edirne": ["Enez","Havsa","Ä°psala","KeÅŸan","LalapaÅŸa","MeriÃ§","Merkez","SÃ¼loÄŸlu","UzunkÃ¶prÃ¼"],
            "ElazÄ±ÄŸ": ["AÄŸÄ±n","Alacakaya","ArÄ±cak","Baskil","KarakoÃ§an","Keban","KovancÄ±lar","Maden","Merkez","Palu","Sivrice"],
            "Erzincan": ["Ã‡ayÄ±rlÄ±","Ä°liÃ§","Kemah","Kemaliye","Merkez","Otlukbeli","Refahiye","Tercan","ÃœzÃ¼mlÃ¼"],
            "Erzurum": ["AÅŸkale","Aziziye","Ã‡at","HÄ±nÄ±s","Horasan","Ä°spir","KaraÃ§oban","KarayazÄ±","KÃ¶prÃ¼kÃ¶y","Narman","Oltu","Olur","PalandÃ¶ken","Pasinler","Pazaryolu","Åženkaya","Tekman","Tortum","Uzundere","Yakutiye"],
            "EskiÅŸehir": ["Alpu","Beylikova","Ã‡ifteler","GÃ¼nyÃ¼zÃ¼","Han","Ä°nÃ¶nÃ¼","Mahmudiye","Mihalgazi","MihalÄ±Ã§Ã§Ä±k","OdunpazarÄ±","SarÄ±cakaya","Seyitgazi","Sivrihisar","TepebaÅŸÄ±"],
            "Gaziantep": ["Araban","Ä°slahiye","KarkamÄ±ÅŸ","Nizip","NurdaÄŸÄ±","OÄŸuzeli","Åžahinbey","Åžehitkamil","Yavuzeli"],
            "Giresun": ["Alucra","Bulancak","Ã‡amoluk","Ã‡anakÃ§Ä±","Dereli","DoÄŸankent","Espiye","Eynesil","GÃ¶rele","GÃ¼ce","KeÅŸap","Merkez","Piraziz","Åžebinkarahisar","Tirebolu","YaÄŸlÄ±dere"],
            "GÃ¼mÃ¼ÅŸhane": ["Kelkit","KÃ¶se","KÃ¼rtÃ¼n","Merkez","Åžiran","Torul"],
            "Hakkari": ["Ã‡ukurca","Derecik","Merkez","Åžemdinli","YÃ¼ksekova"],
            "Hatay": ["AltÄ±nÃ¶zÃ¼","Antakya","Arsuz","Belen","Defne","DÃ¶rtyol","Erzin","Hassa","Ä°skenderun","KÄ±rÄ±khan","Kumlu","Payas","ReyhanlÄ±","SamandaÄŸ","YayladaÄŸÄ±"],
            "IÄŸdÄ±r": ["AralÄ±k","Karakoyunlu","Merkez","Tuzluca"],
            "Isparta": ["Aksu","Atabey","EÄŸirdir","Gelendost","GÃ¶nen","KeÃ§iborlu","Merkez","Senirkent","SÃ¼tÃ§Ã¼ler","ÅžarkikaraaÄŸaÃ§","Uluborlu","YalvaÃ§","YeniÅŸarbademli"],
            "Ä°stanbul": ["Adalar","ArnavutkÃ¶y","AtaÅŸehir","AvcÄ±lar","BaÄŸcÄ±lar","BahÃ§elievler","BakÄ±rkÃ¶y","BaÅŸakÅŸehir","BayrampaÅŸa","BeÅŸiktaÅŸ","Beykoz","BeylikdÃ¼zÃ¼","BeyoÄŸlu","BÃ¼yÃ¼kÃ§ekmece","Ã‡atalca","Ã‡ekmekÃ¶y","Esenler","Esenyurt","EyÃ¼psultan","Fatih","GaziosmanpaÅŸa","GÃ¼ngÃ¶ren","KadÄ±kÃ¶y","KaÄŸÄ±thane","Kartal","KÃ¼Ã§Ã¼kÃ§ekmece","Maltepe","Pendik","Sancaktepe","SarÄ±yer","Silivri","Sultanbeyli","Sultangazi","Åžile","ÅžiÅŸli","Tuzla","Ãœmraniye","ÃœskÃ¼dar","Zeytinburnu"],
            "Ä°zmir": ["AliaÄŸa","BalÃ§ova","BayÄ±ndÄ±r","BayraklÄ±","Bergama","BeydaÄŸ","Bornova","Buca","Ã‡eÅŸme","Ã‡iÄŸli","Dikili","FoÃ§a","Gaziemir","GÃ¼zelbahÃ§e","KarabaÄŸlar","Karaburun","KarÅŸÄ±yaka","KemalpaÅŸa","KÄ±nÄ±k","Kiraz","Konak","Menderes","Menemen","NarlÄ±dere","Ã–demiÅŸ","Seferihisar","SelÃ§uk","Tire","TorbalÄ±","Urla"],
            "KahramanmaraÅŸ": ["AfÅŸin","AndÄ±rÄ±n","Ã‡aÄŸlayancerit","DulkadiroÄŸlu","EkinÃ¶zÃ¼","Elbistan","GÃ¶ksun","Nurhak","OnikiÅŸubat","PazarcÄ±k","TÃ¼rkoÄŸlu"],
            "KarabÃ¼k": ["Eflani","Eskipazar","Merkez","OvacÄ±k","Safranbolu","Yenice"],
            "Karaman": ["AyrancÄ±","BaÅŸyayla","Ermenek","KazÄ±mkarabekir","Merkez","SarÄ±veliler"],
            "Kars": ["Akyaka","ArpaÃ§ay","Digor","KaÄŸÄ±zman","Merkez","SarÄ±kamÄ±ÅŸ","Selim","Susuz"],
            "Kastamonu": ["Abana","AÄŸlÄ±","AraÃ§","Azdavay","Bozkurt","Cide","Ã‡atalzeytin","Daday","Devrekani","DoÄŸanyurt","HanÃ¶nÃ¼","Ä°hsangazi","Ä°nebolu","KÃ¼re","Merkez","PÄ±narbaÅŸÄ±","Seydiler","Åženpazar","TaÅŸkÃ¶prÃ¼","Tosya"],
            "Kayseri": ["AkkÄ±ÅŸla","BÃ¼nyan","Develi","Felahiye","HacÄ±lar","Ä°ncesu","Kocasinan","Melikgazi","Ã–zvatan","PÄ±narbaÅŸÄ±","SarÄ±oÄŸlan","SarÄ±z","Talas","Tomarza","YahyalÄ±","YeÅŸilhisar"],
            "KÄ±rÄ±kkale": ["BahÅŸÄ±lÄ±","BalÄ±ÅŸeyh","Ã‡elebi","Delice","KarakeÃ§ili","Keskin","Merkez","Sulakyurt","YahÅŸihan"],
            "KÄ±rklareli": ["Babaeski","DemirkÃ¶y","KofÃ§az","LÃ¼leburgaz","Merkez","PehlivankÃ¶y","PÄ±narhisar","Vize"],
            "KÄ±rÅŸehir": ["AkÃ§akent","AkpÄ±nar","Boztepe","Ã‡iÃ§ekdaÄŸÄ±","Kaman","Merkez","Mucur"],
            "Kilis": ["Elbeyli","Merkez","Musabeyli","Polateli"],
            "Kocaeli": ["BaÅŸiskele","Ã‡ayÄ±rova","DarÄ±ca","Derince","DilovasÄ±","Gebze","GÃ¶lcÃ¼k","Ä°zmit","KandÄ±ra","KaramÃ¼rsel","Kartepe","KÃ¶rfez"],
            "Konya": ["AhÄ±rlÄ±","AkÃ¶ren","AkÅŸehir","AltÄ±nekin","BeyÅŸehir","BozkÄ±r","Cihanbeyli","Ã‡eltik","Ã‡umra","Derbent","Derebucak","DoÄŸanhisar","Emirgazi","EreÄŸli","GÃ¼neysÄ±nÄ±r","Hadim","HalkapÄ±nar","HÃ¼yÃ¼k","IlgÄ±n","KadÄ±nhanÄ±","KarapÄ±nar","Karatay","Kulu","Meram","SarayÃ¶nÃ¼","SelÃ§uklu","SeydiÅŸehir","TaÅŸkent","TuzlukÃ§u","YalÄ±hÃ¼yÃ¼k","Yunak"],
            "KÃ¼tahya": ["AltÄ±ntaÅŸ","Aslanapa","Ã‡avdarhisar","DomaniÃ§","DumlupÄ±nar","Emet","Gediz","HisarcÄ±k","Merkez","Pazarlar","Simav","Åžaphane","TavÅŸanlÄ±"],
            "Malatya": ["AkÃ§adaÄŸ","Arapgir","Arguvan","Battalgazi","Darende","DoÄŸanÅŸehir","DoÄŸanyol","Hekimhan","Kale","Kuluncak","PÃ¼tÃ¼rge","YazÄ±han","YeÅŸilyurt"],
            "Manisa": ["Ahmetli","Akhisar","AlaÅŸehir","Demirci","GÃ¶lmarmara","GÃ¶rdes","KÄ±rkaÄŸaÃ§","KÃ¶prÃ¼baÅŸÄ±","Kula","Salihli","SarÄ±gÃ¶l","SaruhanlÄ±","Selendi","Soma","Åžehzadeler","Turgutlu","Yunusemre"],
            "Mardin": ["Artuklu","DargeÃ§it","Derik","KÄ±zÄ±ltepe","MazÄ±daÄŸÄ±","Midyat","Nusaybin","Ã–merli","Savur","YeÅŸilli"],
            "Mersin": ["Akdeniz","Anamur","AydÄ±ncÄ±k","BozyazÄ±","Ã‡amlÄ±yayla","Erdemli","GÃ¼lnar","Mezitli","Mut","Silifke","Tarsus","Toroslar","YeniÅŸehir"],
            "MuÄŸla": ["Bodrum","Dalaman","DatÃ§a","Fethiye","KavaklÄ±dere","KÃ¶yceÄŸiz","Marmaris","MenteÅŸe","Milas","Ortaca","Seydikemer","Ula","YataÄŸan"],
            "MuÅŸ": ["BulanÄ±k","HaskÃ¶y","Korkut","Malazgirt","Merkez","Varto"],
            "NevÅŸehir": ["AcÄ±gÃ¶l","Avanos","Derinkuyu","GÃ¼lÅŸehir","HacÄ±bektaÅŸ","KozaklÄ±","Merkez","ÃœrgÃ¼p"],
            "NiÄŸde": ["Altunhisar","Bor","Ã‡amardÄ±","Ã‡iftlik","Merkez","UlukÄ±ÅŸla"],
            "Ordu": ["AkkuÅŸ","AltÄ±nordu","AybastÄ±","Ã‡amaÅŸ","Ã‡atalpÄ±nar","Ã‡aybaÅŸÄ±","Fatsa","GÃ¶lkÃ¶y","GÃ¼lyalÄ±","GÃ¼rgentepe","Ä°kizce","KabadÃ¼z","KabataÅŸ","Korgan","Kumru","Mesudiye","PerÅŸembe","Ulubey","Ãœnye"],
            "Osmaniye": ["BahÃ§e","DÃ¼ziÃ§i","Hasanbeyli","Kadirli","Merkez","Sumbas","Toprakkale"],
            "Rize": ["ArdeÅŸen","Ã‡amlÄ±hemÅŸin","Ã‡ayeli","DerepazarÄ±","FÄ±ndÄ±klÄ±","GÃ¼neysu","HemÅŸin","Ä°kizdere","Ä°yidere","Kalkandere","Merkez","Pazar"],
            "Sakarya": ["AdapazarÄ±","AkyazÄ±","Arifiye","Erenler","Ferizli","Geyve","Hendek","KarapÃ¼rÃ§ek","Karasu","Kaynarca","Kocaali","Pamukova","Sapanca","Serdivan","SÃ¶ÄŸÃ¼tlÃ¼","TaraklÄ±"],
            "Samsun": ["19 MayÄ±s","AlaÃ§am","AsarcÄ±k","Atakum","AyvacÄ±k","Bafra","Canik","Ã‡arÅŸamba","Havza","Ä°lkadÄ±m","Kavak","Ladik","SalÄ±pazarÄ±","TekkekÃ¶y","Terme","VezirkÃ¶prÃ¼","Yakakent"],
            "Siirt": ["Baykan","Eruh","Kurtalan","Merkez","Pervari","Åžirvan","Tillo"],
            "Sinop": ["AyancÄ±k","Boyabat","Dikmen","DuraÄŸan","Erfelek","Gerze","Merkez","SaraydÃ¼zÃ¼","TÃ¼rkeli"],
            "Sivas": ["AkÄ±ncÄ±lar","AltÄ±nyayla","DivriÄŸi","DoÄŸanÅŸar","Gemerek","GÃ¶lova","GÃ¼rÃ¼n","Hafik","Ä°mranlÄ±","Kangal","Koyulhisar","Merkez","SuÅŸehri","ÅžarkÄ±ÅŸla","UlaÅŸ","YÄ±ldÄ±zeli","Zara"],
            "ÅžanlÄ±urfa": ["AkÃ§akale","Birecik","Bozova","CeylanpÄ±nar","EyyÃ¼biye","Halfeti","Haliliye","Harran","Hilvan","KarakÃ¶prÃ¼","Siverek","SuruÃ§","ViranÅŸehir"],
            "ÅžÄ±rnak": ["BeytÃ¼ÅŸÅŸebap","Cizre","GÃ¼Ã§lÃ¼konak","Ä°dil","Merkez","Silopi","Uludere"],
            "TekirdaÄŸ": ["Ã‡erkezkÃ¶y","Ã‡orlu","Ergene","Hayrabolu","KapaklÄ±","Malkara","MarmaraereÄŸlisi","MuratlÄ±","Saray","SÃ¼leymanpaÅŸa","ÅžarkÃ¶y"],
            "Tokat": ["Almus","Artova","BaÅŸÃ§iftlik","Erbaa","Merkez","Niksar","Pazar","ReÅŸadiye","Sulusaray","Turhal","YeÅŸilyurt","Zile"],
            "Trabzon": ["AkÃ§aabat","AraklÄ±","Arsin","BeÅŸikdÃ¼zÃ¼","Ã‡arÅŸÄ±baÅŸÄ±","Ã‡aykara","DernekpazarÄ±","DÃ¼zkÃ¶y","Hayrat","KÃ¶prÃ¼baÅŸÄ±","MaÃ§ka","Of","Ortahisar","SÃ¼rmene","ÅžalpazarÄ±","Tonya","VakfÄ±kebir","Yomra"],
            "Tunceli": ["Ã‡emiÅŸgezek","Hozat","Mazgirt","Merkez","NazÄ±miye","OvacÄ±k","Pertek","PÃ¼lÃ¼mÃ¼r"],
            "UÅŸak": ["Banaz","EÅŸme","KarahallÄ±","Merkez","SivaslÄ±","Ulubey"],
            "Van": ["BahÃ§esaray","BaÅŸkale","Ã‡aldÄ±ran","Ã‡atak","Edremit","ErciÅŸ","GevaÅŸ","GÃ¼rpÄ±nar","Ä°pekyolu","Muradiye","Ã–zalp","Saray","TuÅŸba"],
            "Yalova": ["AltÄ±nova","Armutlu","Ã‡Ä±narcÄ±k","Ã‡iftlikkÃ¶y","Merkez","Termal"],
            "Yozgat": ["AkdaÄŸmadeni","AydÄ±ncÄ±k","BoÄŸazlÄ±yan","Ã‡andÄ±r","Ã‡ayÄ±ralan","Ã‡ekerek","KadÄ±ÅŸehri","Merkez","Saraykent","SarÄ±kaya","Sorgun","Åžefaatli","YenifakÄ±lÄ±","YerkÃ¶y"],
            "Zonguldak": ["AlaplÄ±","Ã‡aycuma","Devrek","EreÄŸli","GÃ¶kÃ§ebey","Kilimli","kozlu","Merkez"]
        };

        const BRANSLAR = [
            { label: "Temel EÄŸitim", options: ["SÄ±nÄ±f Ã–ÄŸretmenliÄŸi", "Okul Ã–ncesi Ã–ÄŸretmenliÄŸi", "Ã‡ocuk GeliÅŸimi"] },
            { label: "SayÄ±sal", options: ["Matematik (Ä°lkÃ¶ÄŸretim)", "Matematik (Lise)", "Fen Bilimleri", "Fizik", "Kimya", "Biyoloji"] },
            { label: "SÃ¶zel & EÅŸit AÄŸÄ±rlÄ±k", options: ["TÃ¼rkÃ§e", "TÃ¼rk Dili ve EdebiyatÄ±", "Tarih", "CoÄŸrafya", "Sosyal Bilgiler", "Felsefe"] },
            { label: "YabancÄ± Dil", options: ["Ä°ngilizce", "Almanca", "ArapÃ§a", "RusÃ§a", "FransÄ±zca"] },
            { label: "Ã–zel EÄŸitim & Rehberlik", options: ["Ã–zel EÄŸitim Ã–ÄŸretmeni", "Rehber Ã–ÄŸretmen / PDR", "Psikolog", "Uzman Ã–ÄŸretici"] },
            { label: "Rehabilitasyon / SaÄŸlÄ±k", options: ["Fizyoterapist", "Dil ve KonuÅŸma Terapisti", "Ergoterapist", "Odyolog"] },
            { label: "Yetenek", options: ["Beden EÄŸitimi", "MÃ¼zik", "GÃ¶rsel Sanatlar", "BiliÅŸim Teknolojileri"] },
            { label: "DiÄŸer", options: ["Din KÃ¼ltÃ¼rÃ¼", "YÃ¶netici / MÃ¼dÃ¼r", "EÄŸitim KoÃ§u", "DiÄŸer Personel"] }
        ];
        
        const COLLECTION_NAME = 'is_ilanlari_2026';
        const CONFIG_DOC = 'is_config/global';

        const firebaseConfig = {
            apiKey: "AIzaSyAqeO-yQyQPnLsOqKmSNvVH23WPvneIjaU",
            authDomain: "shaped-totem-481514-c5.firebaseapp.com",
            projectId: "shaped-totem-481514-c5",
            storageBucket: "shaped-totem-481514-c5.firebasestorage.app",
            messagingSenderId: "519295049418",
            appId: "1:519295049418:web:7d04e18c4ea36bc088de33"
        };
        
        let db, auth, user;
        let globalJobs = [];
        let globalConfig = { news: "", popup: "" };
        let isAdmin = false;
        let activeFilterType = 'all';
        let deleteTargetId = null;

        async function init() {
            populateCitySelects();
            populateRoles();
            updateFavoritesBadge();
            
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                onAuthStateChanged(auth, (u) => {
                    if(u) { 
                        user = u; 
                        startRealtimeListener(); 
                        startConfigListener();
                        
                        if(!u.isAnonymous) {
                            isAdmin = true;
                            document.getElementById('admin-login-view').classList.add('hidden');
                            document.getElementById('admin-controls-view').classList.remove('hidden');
                        }
                    } else {
                        signInAnonymously(auth);
                    }
                });

            } catch (error) {
                console.error("Init error", error);
                document.querySelector('#app-loader p').innerText = "BaÄŸlantÄ± hatasÄ± oluÅŸtu.";
            }
        }

        function startRealtimeListener() {
            const q = query(collection(db, COLLECTION_NAME), orderBy('timestamp', 'desc'));
            onSnapshot(q, (snapshot) => {
                globalJobs = [];
                snapshot.forEach(doc => { globalJobs.push({ id: doc.id, ...doc.data() }); });
                document.getElementById('app-loader').classList.add('hidden');
                
                applyFilters();
                if(isAdmin) renderAdminList(); 
            });
        }

        function startConfigListener() {
            onSnapshot(doc(db, "is_config", "global"), (docSnap) => {
                if (docSnap.exists()) {
                    globalConfig = docSnap.data();
                    applyConfig();
                } else {
                    applyConfig();
                }
            });
        }

        function applyConfig() {
            if(globalConfig.news) {
                const marqueeEl = document.getElementById('marquee-text');
                marqueeEl.innerHTML = globalConfig.news;
            }

            let showWelcome = true;
            if(globalConfig.popup && globalConfig.popup.trim() !== "") {
                if(sessionStorage.getItem('last_popup_job') !== globalConfig.popup) {
                    const popupText = globalConfig.popup;
                    const linkedText = popupText.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" class="text-indigo-600 underline font-bold hover:text-indigo-800">$1</a>');
                    document.getElementById('user-popup-content').innerHTML = linkedText;
                    document.getElementById('user-announcement-modal').classList.remove('hidden');
                    sessionStorage.setItem('last_popup_job', globalConfig.popup);
                    showWelcome = false;
                } else {
                     showWelcome = false;
                }
            }

            if(showWelcome) {
                setTimeout(() => {
                    document.getElementById('welcome-modal').classList.remove('hidden');
                }, 800);
            }
        }

        window.toggleContactFields = () => {
             const method = document.querySelector('input[name="contactMethod"]:checked').value;
             if(method === 'email') {
                 document.getElementById('field-phone').classList.add('hidden');
                 document.getElementById('field-email').classList.remove('hidden');
                 document.getElementById('post-email').required = true;
                 document.getElementById('post-phone').required = false;
             } else {
                 document.getElementById('field-phone').classList.remove('hidden');
                 document.getElementById('field-email').classList.add('hidden');
                 document.getElementById('post-email').required = false;
                 document.getElementById('post-phone').required = true;
             }
        };

        window.saveConfig = async (type) => {
            if(!isAdmin) return;
            const val = document.getElementById(`admin-input-${type}`).value;
            const updateData = {};
            updateData[type] = val;
            try {
                await setDoc(doc(db, "is_config", "global"), updateData, { merge: true });
                showToast("Ayar baÅŸarÄ±yla gÃ¼ncellendi!", "success");
            } catch(e) { showToast("Hata: " + e.message, "error"); }
        };

        function populateCitySelects() {
            const entryCity = document.getElementById('entry-city');
            const filterCity = document.getElementById('filter-city');
            const cities = Object.keys(TURKEY_DATA).sort();
            cities.forEach(city => {
                const opt = `<option value="${city}">${city}</option>`;
                entryCity.innerHTML += opt;
                filterCity.innerHTML += opt;
            });
        }

        function populateRoles() {
            const postRole = document.getElementById('post-role');
            const filterRole = document.getElementById('filter-role');
            BRANSLAR.forEach(group => {
                const optgroup = document.createElement('optgroup');
                optgroup.label = group.label;
                group.options.forEach(role => {
                    const opt = document.createElement('option');
                    opt.value = role;
                    opt.innerText = role;
                    optgroup.appendChild(opt);
                    const optFilter = opt.cloneNode(true);
                    filterRole.appendChild(optFilter);
                });
                postRole.appendChild(optgroup);
            });
        }

        window.updateDistricts = (type) => {
            const citySelect = document.getElementById(type === 'entry' ? 'entry-city' : 'filter-city');
            const districtSelect = document.getElementById('entry-district');
            if(type === 'filter') return; 

            const selectedCity = citySelect.value;
            districtSelect.innerHTML = '<option value="" disabled selected>Ä°lÃ§e SeÃ§...</option>';
            if (selectedCity && selectedCity !== 'all' && TURKEY_DATA[selectedCity]) {
                districtSelect.disabled = false;
                TURKEY_DATA[selectedCity].sort().forEach(dist => {
                    districtSelect.innerHTML += `<option value="${dist}">${dist}</option>`;
                });
            } else {
                districtSelect.disabled = true;
            }
        };

        window.switchTab = (t) => {
            document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active'));
            if (t === 'favorites') {
                renderFavorites();
                document.getElementById('tab-favorites').classList.add('active');
            } else {
                document.getElementById(t === 'jobs' ? 'tab-jobs' : 'tab-post').classList.add('active');
            }
            
            const btnJobs = document.getElementById('tab-btn-jobs');
            const btnPost = document.getElementById('tab-btn-post');
            const activeClass = "flex-1 py-3 text-sm font-bold rounded-xl transition-all text-white bg-indigo-600 shadow-sm flex items-center justify-center gap-2";
            const passiveClass = "flex-1 py-3 text-sm font-bold rounded-xl transition-all text-slate-500 hover:bg-slate-50 flex items-center justify-center gap-2";
            
            if(btnJobs && btnPost) {
                btnJobs.className = t === 'jobs' ? activeClass : passiveClass;
                btnPost.className = t === 'post' ? activeClass : passiveClass;
            }
        };

        window.closeWelcomeModal = () => {
            const modal = document.getElementById('welcome-modal');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        window.updateFormLabels = () => {
            const type = document.querySelector('input[name="postType"]:checked').value;
            if(type === 'teacher') {
                document.getElementById('lbl-title').innerText = "ÃœnvanÄ±nÄ±z / BranÅŸÄ±nÄ±z";
                document.getElementById('post-title').placeholder = "Ã–rn: SÄ±nÄ±f Ã–ÄŸretmeni, MatematikÃ§i...";
                document.getElementById('lbl-name').innerText = "Ad Soyad";
                document.getElementById('post-company').placeholder = "AdÄ±nÄ±z SoyadÄ±nÄ±z";
                document.getElementById('lbl-desc').innerText = "Kendinizi TanÄ±tÄ±n / TecrÃ¼beleriniz";
                document.getElementById('post-desc').placeholder = "Mezuniyet, tecrÃ¼be, aradÄ±ÄŸÄ±nÄ±z Ã§alÄ±ÅŸma ÅŸekli vb.";
            } else {
                document.getElementById('lbl-title').innerText = "Ä°lan BaÅŸlÄ±ÄŸÄ±";
                document.getElementById('post-title').placeholder = "Ã–rn: TecrÃ¼beli Matematik Ã–ÄŸretmeni ArÄ±yoruz";
                document.getElementById('lbl-name').innerText = "Kurum AdÄ±";
                document.getElementById('post-company').placeholder = "Kurumunuzun adÄ±";
                document.getElementById('lbl-desc').innerText = "Detaylar";
                document.getElementById('post-desc').placeholder = "Ä°ÅŸ tanÄ±mÄ±, Ã§alÄ±ÅŸma saatleri, aranan Ã¶zellikler vb.";
            }
        };

        window.setFilterType = (type) => {
            activeFilterType = type;
            document.getElementById('ft-all').className = `flex-1 py-2 rounded-lg text-xs font-bold transition-all ${type==='all' ? 'bg-white text-slate-800 shadow-sm' : 'text-slate-500 hover:text-slate-800'}`;
            document.getElementById('ft-institution').className = `flex-1 py-2 rounded-lg text-xs font-bold transition-all ${type==='institution' ? 'bg-white text-green-700 shadow-sm' : 'text-slate-500 hover:text-green-600'}`;
            document.getElementById('ft-teacher').className = `flex-1 py-2 rounded-lg text-xs font-bold transition-all ${type==='teacher' ? 'bg-white text-blue-700 shadow-sm' : 'text-slate-500 hover:text-blue-600'}`;
            applyFilters();
        };

        window.applyFilters = () => {
            const fCity = document.getElementById('filter-city').value;
            const roleEl = document.getElementById('filter-role');
            const fRole = roleEl ? roleEl.value : 'all';
            const fText = document.getElementById('search-text').value.toLowerCase();

            let filtered = globalJobs;
            if(activeFilterType !== 'all') filtered = filtered.filter(j => j.type === activeFilterType);
            if(fCity !== 'all') filtered = filtered.filter(j => j.city === fCity);
            if(fRole !== 'all') filtered = filtered.filter(j => j.role === fRole);
            if(fText.length > 0) {
                filtered = filtered.filter(j => 
                    j.title.toLowerCase().includes(fText) || 
                    j.company.toLowerCase().includes(fText) ||
                    j.role.toLowerCase().includes(fText)
                );
            }
            renderJobs(filtered, 'jobs-container', 'no-jobs-msg');
        };

        // --- FAVORITES LOGIC ---
        function getFavorites() {
            return JSON.parse(localStorage.getItem('favJobs') || '[]');
        }

        window.toggleFavorite = (id) => {
            let favs = getFavorites();
            if(favs.includes(id)) {
                favs = favs.filter(fid => fid !== id);
                showToast("Favorilerden Ã§Ä±karÄ±ldÄ±", "info");
            } else {
                favs.push(id);
                showToast("Favorilere eklendi", "success");
            }
            localStorage.setItem('favJobs', JSON.stringify(favs));
            updateFavoritesBadge();
            // Refresh views
            const btn = document.getElementById(`fav-btn-${id}`);
            if(btn) {
                btn.innerHTML = favs.includes(id) ? '<i class="fa-solid fa-heart"></i>' : '<i class="fa-regular fa-heart"></i>';
                btn.classList.toggle('text-red-500', favs.includes(id));
                btn.classList.toggle('text-slate-300', !favs.includes(id));
            }
            // If in fav view, refresh list
            if(document.getElementById('tab-favorites').classList.contains('active')) {
                renderFavorites();
            }
        };

        function updateFavoritesBadge() {
            const count = getFavorites().length;
            const badge = document.getElementById('fav-count-badge');
            badge.innerText = count;
            badge.classList.toggle('hidden', count === 0);
        }

        function renderFavorites() {
            const favIds = getFavorites();
            const favJobs = globalJobs.filter(j => favIds.includes(j.id));
            renderJobs(favJobs, 'fav-container', 'no-fav-msg');
        }

        window.shareJob = (id) => {
            const job = globalJobs.find(j => j.id === id);
            if(!job) return;
            const text = `${job.title}\n${job.company}\n${job.city}/${job.district}\n\nDetaylar iÃ§in Ã–ÄŸretmen Ä°ÅŸ AÄŸÄ±'na bak!`;
            if (navigator.share) {
                navigator.share({ title: job.title, text: text }).catch(console.error);
            } else {
                navigator.clipboard.writeText(text);
                showToast("Ä°lan metni kopyalandÄ±!", "success");
            }
        };

        function renderJobs(jobs, containerId, msgId) {
            const container = document.getElementById(containerId);
            const msg = document.getElementById(msgId);
            if(containerId === 'jobs-container') document.getElementById('active-job-count').innerText = jobs.length;
            
            container.innerHTML = '';
            if(jobs.length === 0) {
                msg.classList.remove('hidden');
                return;
            }
            msg.classList.add('hidden');

            const favs = getFavorites();

            jobs.forEach(job => {
                const date = job.timestamp ? job.timestamp.toDate() : new Date();
                const diffTime = Math.abs(new Date() - date);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                let timeStr = diffDays <= 1 ? "Yeni" : `${diffDays} gÃ¼n Ã¶nce`;
                
                // Contact Buttons Logic
                let contactButtons = '';
                if (job.email && !job.phone) {
                     // Email Only Mode
                     contactButtons = `
                        <a href="mailto:${job.email}?subject=${encodeURIComponent(job.title)} BaÅŸvurusu" class="col-span-2 flex items-center justify-center gap-2 bg-slate-800 text-white font-bold py-2.5 rounded-xl hover:bg-slate-700 transition text-xs shadow-lg">
                            <i class="fa-solid fa-envelope"></i> E-posta GÃ¶nder
                        </a>
                     `;
                } else {
                    // Standard Phone Mode
                    const cleanPhone = job.phone ? job.phone.replace(/[^0-9]/g, '') : '';
                    const whatsappText = job.type === 'teacher' ? 
                        `Merhaba ${job.company}, iÅŸ ilanÄ±nÄ±z iÃ§in yazÄ±yorum.` : 
                        `Merhaba, ${job.company} ilanÄ±nÄ±z iÃ§in yazÄ±yorum.`;
                    const whatsappLink = `https://wa.me/90${cleanPhone.startsWith('0') ? cleanPhone.substring(1) : cleanPhone}?text=${encodeURIComponent(whatsappText)}`;
                    
                    contactButtons = `
                        <a href="tel:${job.phone}" class="flex items-center justify-center gap-2 border border-slate-200 text-slate-600 font-bold py-2.5 rounded-xl hover:bg-slate-50 transition text-xs">
                            <i class="fa-solid fa-phone"></i> Ara
                        </a>
                        <a href="${whatsappLink}" target="_blank" class="flex items-center justify-center gap-2 ${job.type === 'teacher' ? 'bg-blue-600 hover:bg-blue-700 shadow-blue-200' : 'bg-green-600 hover:bg-green-700 shadow-green-200'} text-white font-bold py-2.5 rounded-xl transition text-xs shadow-lg">
                            <i class="fa-brands fa-whatsapp text-sm"></i> Mesaj At
                        </a>
                    `;
                }

                const isTeacher = job.type === 'teacher';
                const gradClass = isTeacher ? 'from-blue-500 to-indigo-600' : 'from-green-500 to-emerald-600';
                const bgLight = isTeacher ? 'bg-blue-50' : 'bg-green-50';
                const textDark = isTeacher ? 'text-blue-700' : 'text-green-700';
                const icon = isTeacher ? 'fa-user-graduate' : 'fa-building';
                const badgeText = isTeacher ? 'Ã–ÄžRETMEN' : 'KURUM';
                const isFav = favs.includes(job.id);
                
                container.innerHTML += `
                    <div class="job-card bg-white rounded-2xl flex flex-col h-full relative group">
                        <div class="h-1.5 bg-gradient-to-r ${gradClass} w-full absolute top-0 left-0"></div>
                        
                        <!-- Action Buttons Top Right -->
                        <div class="absolute top-3 right-3 flex gap-2">
                             <button onclick="shareJob('${job.id}')" class="card-action-btn text-slate-300 hover:text-indigo-500 transition p-1.5 bg-white/90 rounded-full shadow-sm" title="PaylaÅŸ">
                                <i class="fa-solid fa-share-nodes"></i>
                             </button>
                             <button id="fav-btn-${job.id}" onclick="toggleFavorite('${job.id}')" class="text-lg transition p-1 ${isFav ? 'text-red-500' : 'text-slate-300 hover:text-red-400'}" title="Favorilere Ekle">
                                <i class="${isFav ? 'fa-solid' : 'fa-regular'} fa-heart"></i>
                             </button>
                             <button onclick="openDeleteModal('${job.id}')" class="card-action-btn text-slate-300 hover:text-red-500 transition p-1.5 bg-white/90 rounded-full shadow-sm" title="Ä°lanÄ± KaldÄ±r">
                                <i class="fa-solid fa-trash-can"></i>
                             </button>
                        </div>

                        <div class="p-5 flex flex-col h-full">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex items-center gap-2">
                                     <span class="${bgLight} ${textDark} text-[10px] font-bold px-2 py-1 rounded-md uppercase tracking-wider flex items-center gap-1">
                                        <i class="fa-solid ${icon}"></i> ${badgeText}
                                     </span>
                                     <span class="text-[10px] text-slate-400 font-medium">${timeStr}</span>
                                </div>
                            </div>

                            <h3 class="font-bold text-slate-800 text-lg leading-tight mb-1">${job.title}</h3>
                            <p class="${textDark} font-bold text-sm mb-3 flex items-center gap-1">
                                <span class="truncate">${job.company}</span>
                                ${isTeacher ? '<i class="fa-solid fa-circle-check text-blue-400 text-xs"></i>' : ''}
                            </p>
                            
                            <div class="flex flex-wrap gap-2 mb-4 text-xs text-slate-500 font-medium">
                                <span class="flex items-center gap-1 bg-slate-50 px-2.5 py-1.5 rounded-lg border border-slate-100"><i class="fa-solid fa-location-dot text-slate-300"></i> ${job.city} / ${job.district}</span>
                                <span class="flex items-center gap-1 bg-slate-50 px-2.5 py-1.5 rounded-lg border border-slate-100"><i class="fa-solid fa-layer-group text-slate-300"></i> ${job.role}</span>
                                ${job.workType ? `<span class="flex items-center gap-1 bg-orange-50 text-orange-600 px-2.5 py-1.5 rounded-lg border border-orange-100"><i class="fa-solid fa-briefcase"></i> ${job.workType}</span>` : ''}
                            </div>

                            <div class="bg-slate-50 p-3 rounded-xl border border-slate-100 mb-5 flex-grow">
                                <p class="text-xs text-slate-600 line-clamp-4 leading-relaxed">${job.desc}</p>
                            </div>

                            <div class="grid grid-cols-2 gap-3 mt-auto">
                                ${contactButtons}
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        document.getElementById('jobForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submit-btn');
            
            const type = document.querySelector('input[name="postType"]:checked').value;
            const contactMethod = document.querySelector('input[name="contactMethod"]:checked').value;
            
            const title = document.getElementById('post-title').value;
            const company = document.getElementById('post-company').value;
            const role = document.getElementById('post-role').value;
            const workType = document.getElementById('post-work-type').value;
            const city = document.getElementById('entry-city').value;
            const district = document.getElementById('entry-district').value;
            const desc = document.getElementById('post-desc').value;
            const contactPerson = document.getElementById('post-contact-person').value;
            const pin = document.getElementById('post-pin').value;
            
            // Conditional Fields
            const phone = contactMethod === 'phone' ? document.getElementById('post-phone').value : null;
            const email = contactMethod === 'email' ? document.getElementById('post-email').value : null;

            if(!city || !district) { showToast("LÃ¼tfen ÅŸehir ve ilÃ§e seÃ§in.", "error"); return; }
            if(!pin || pin.length !== 4) { showToast("LÃ¼tfen 4 haneli bir gÃ¼venlik pini girin.", "error"); return; }
            
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> YayÄ±nlanÄ±yor...';
            btn.disabled = true;

            try {
                await addDoc(collection(db, COLLECTION_NAME), {
                    type, title, company, role, workType, city, district, desc, phone, email, contactPerson, pin,
                    uid: user ? user.uid : 'anon',
                    timestamp: serverTimestamp()
                });
                
                showToast("Ä°lanÄ±nÄ±z baÅŸarÄ±yla yayÄ±nlandÄ±!", "success");
                document.getElementById('jobForm').reset();
                document.querySelector('input[name="postType"][value="institution"]').checked = true;
                // Reset Contact Method to phone default
                document.querySelector('input[name="contactMethod"][value="phone"]').checked = true;
                toggleContactFields();
                
                updateFormLabels();
                switchTab('jobs');
            } catch (err) {
                console.error(err);
                showToast("Hata: " + err.message, "error");
            } finally {
                btn.innerHTML = '<span>Ä°lanÄ± YayÄ±nla</span><i class="fa-solid fa-paper-plane"></i>';
                btn.disabled = false;
            }
        });

        window.openDeleteModal = (id) => {
            deleteTargetId = id;
            document.getElementById('delete-pin-input').value = '';
            document.getElementById('delete-modal').classList.remove('hidden');
        };

        window.closeDeleteModal = () => {
            deleteTargetId = null;
            document.getElementById('delete-modal').classList.add('hidden');
        };

        window.confirmDelete = async () => {
            const pinInput = document.getElementById('delete-pin-input').value;
            if(!deleteTargetId) return;
            if(!pinInput) { showToast("LÃ¼tfen pini giriniz.", "error"); return; }
            try {
                const docRef = doc(db, COLLECTION_NAME, deleteTargetId);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    if(data.pin === pinInput) {
                        await deleteDoc(docRef);
                        showToast("Ä°lan baÅŸarÄ±yla kaldÄ±rÄ±ldÄ±.", "success");
                        closeDeleteModal();
                        // Also remove from favs if exists
                        let favs = getFavorites().filter(id => id !== deleteTargetId);
                        localStorage.setItem('favJobs', JSON.stringify(favs));
                        updateFavoritesBadge();
                    } else {
                        showToast("HatalÄ± pin kodu!", "error");
                    }
                } else {
                    showToast("Ä°lan bulunamadÄ±.", "error");
                    closeDeleteModal();
                }
            } catch (error) {
                console.error(error);
                showToast("Bir hata oluÅŸtu.", "error");
            }
        };

        window.toggleAdminPanel = () => {
            document.getElementById('admin-modal').classList.toggle('hidden');
        };

        window.adminLogin = () => {
            const email = document.getElementById('admin-email').value;
            const pass = document.getElementById('admin-pass').value;
            signInWithEmailAndPassword(auth, email, pass)
                .then(() => {
                    isAdmin = true;
                    document.getElementById('admin-login-view').classList.add('hidden');
                    document.getElementById('admin-controls-view').classList.remove('hidden');
                    renderAdminList();
                    document.getElementById('admin-input-news').value = globalConfig.news || "";
                    document.getElementById('admin-input-popup').value = globalConfig.popup || "";
                })
                .catch(() => document.getElementById('admin-msg').classList.remove('hidden'));
        };

        window.logoutAdmin = () => signOut(auth).then(() => location.reload());

        window.deleteRecord = async (id) => {
            if(confirm('Ä°lan silinsin mi?')) {
                await deleteDoc(doc(db, COLLECTION_NAME, id));
                renderAdminList();
            }
        };

        function renderAdminList() {
            const list = document.getElementById('admin-records-list');
            document.getElementById('admin-record-count').innerText = globalJobs.length;
            list.innerHTML = '';
            globalJobs.forEach(job => {
                const bg = job.type === 'teacher' ? 'bg-blue-50 border-blue-100' : 'bg-green-50 border-green-100';
                list.innerHTML += `
                    <div class="flex justify-between items-center ${bg} p-3 rounded-lg border mb-2">
                        <div>
                            <p class="font-bold text-xs text-slate-800">${job.title}</p>
                            <p class="text-[10px] text-slate-500">${job.company} | ${job.type === 'teacher' ? 'Ã–ÄŸretmen' : 'Kurum'}</p>
                        </div>
                        <button onclick="deleteRecord('${job.id}')" class="text-red-500 hover:bg-red-50 p-2 rounded-full"><i class="fa-solid fa-trash"></i></button>
                    </div>
                `;
            });
        }

        window.showToast = (msg, type='info') => Toastify({ text: msg, duration: 3000, gravity: "top", position: "center", backgroundColor: type==='error'?"#ef4444":"#4f46e5", className: "rounded-lg font-bold text-sm shadow-xl" }).showToast();

        init();
    </script>
</body>
</html>
